<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row =>
                    row.some(cell => cell !== '' && cell !== null && cell !== undefined)
                );

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="console-title">XX當鋪 - 後台管理</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(to bottom, #E5E7EB, #D1D5DB);
            font-family: 'Noto Sans TC', sans-serif;
        }
        .container {
            max-width: 1000px;
            margin: 40px auto;
            padding: 0;
        }
        .header {
            background: #4A90E2;
            color: white;
            padding: 20px;
            border-radius: 12px 12px 0 0;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        .header h1 {
            font-size: 2.5rem;
            margin: 0;
        }
        .content {
            background: white;
            border-radius: 0 0 12px 12px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .card {
            background: #F9FAFB;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }
        .card:hover {
            transform: translateY(-4px);
        }
        .card h2 {
            font-size: 1.5rem;
            color: #4A4A4A;
            margin-bottom: 15px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            font-weight: 500;
            color: #4A4A4A;
            margin-bottom: 8px;
        }
        input[type="text"], input[type="number"], input[type="file"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid #D1D5DB;
            border-radius: 6px;
            transition: border-color 0.2s ease;
        }
        input[type="text"]:focus, input[type="number"]:focus, input[type="file"]::file-selector-button, select:focus {
            border-color: #4A90E2;
            outline: none;
        }
        input[type="file"]::file-selector-button {
            background: #4A90E2;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
        }
        input[type="file"]::file-selector-button:hover {
            background: #2563EB;
        }
        .photo-upload-group {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .error {
            color: #EF4444;
            display: none;
            margin-top: 8px;
            font-size: 0.9rem;
        }
        .upload-btn, .update-contact-btn, .update-name-btn, .update-website-btn {
            display: block;
            width: 200px;
            margin: 30px auto 0;
            padding: 12px;
            background: #2563EB;
            color: white;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s ease, transform 0.2s ease;
        }
        .upload-btn:hover, .update-contact-btn:hover, .update-name-btn:hover, .update-website-btn:hover {
            background: #3B82F6;
            transform: scale(1.05);
        }
        .upload-btn:active, .update-contact-btn:active, .update-name-btn:active, .update-website-btn:active {
            transform: scale(0.95);
        }
        .download-section {
            margin-top: 20px;
            text-align: left;
        }
        .download-section a {
            color: #4A90E2;
            font-weight: 500;
            text-decoration: underline;
        }
        .download-section a:hover {
            color: #2563EB;
        }
        @media (max-width: 768px) {
            .container {
                margin: 20px;
            }
            .header h1 {
                font-size: 1.8rem;
            }
            .card {
                padding: 15px;
            }
            .card h2 {
                font-size: 1.2rem;
            }
            .photo-upload-group {
                flex-direction: column;
                gap: 10px;
            }
            .upload-btn, .update-contact-btn, .update-name-btn, .update-website-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="header-title">XX當鋪後台管理</h1>
        </div>
        <div class="content">
            <!-- PAT 輸入 -->
            <div class="card">
                <h2>認證設置</h2>
                <div class="input-group">
                    <label>Personal Access Token</label>
                    <input type="text" id="github-token" placeholder="輸入你的 PAT">
                    <p id="error-message" class="error">請輸入有效的 PAT！</p>
                </div>
            </div>

            <!-- 網站名稱設定 -->
            <div class="card">
                <h2>網站名稱設定</h2>
                <div class="input-group">
                    <label>網站名稱</label>
                    <input type="text" id="name-input" placeholder="輸入網站名稱">
                </div>
                <p class="text-sm text-gray-600">更改網站名稱會更新全站顯示並最佳化 SEO（標題、描述、關鍵字）。</p>
                <button id="update-name-btn" class="update-name-btn">更新網站名稱</button>
            </div>

            <!-- 網站地址設定 -->
            <div class="card">
                <h2>網站地址設定</h2>
                <div class="input-group">
                    <label>網站地址</label>
                    <input type="text" id="website-input" placeholder="輸入網站地址 (例如 https://example.com)">
                </div>
                <p class="text-sm text-gray-600">更改網站地址會更新分享連結（Facebook、X、Instagram、Line）。</p>
                <button id="update-website-btn" class="update-website-btn">更新網站地址</button>
            </div>

            <!-- 內容更新 -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- 更新首頁 -->
                <div class="card">
                    <h2>更新首頁</h2>
                    <div class="input-group">
                        <label>上傳首頁內容（必須為 index.txt）</label>
                        <input type="file" id="index-upload" accept="text/plain,.txt">
                    </div>
                </div>

                <!-- 更新最新消息 -->
                <div class="card">
                    <h2>更新最新消息</h2>
                    <div class="input-group">
                        <label>上傳文字內容（必須為 news.txt）</label>
                        <input type="file" id="news-upload" accept="text/plain,.txt">
                    </div>
                    <div class="input-group">
                        <label>上傳圖片</label>
                        <div class="photo-upload-group">
                            <input type="number" id="photo-count" min="1" max="50" placeholder="照片數量" value="10">
                            <select id="photo-select"></select>
                            <input type="file" id="photo-upload" accept="image/jpeg,image/jpg,.jpg">
                        </div>
                    </div>
                </div>

                <!-- 更新服務介紹 -->
                <div class="card">
                    <h2>更新服務介紹</h2>
                    <div class="input-group">
                        <label>上傳文字內容（必須為 service.txt）</label>
                        <input type="file" id="service-upload" accept="text/plain,.txt">
                    </div>
                    <div class="input-group">
                        <label>上傳圖片</label>
                        <select id="service-photo-select">
                            <option value="1">service1.jpg (汽車借款)</option>
                            <option value="2">service2.jpg (機車借款)</option>
                            <option value="3">service3.jpg (房屋借款)</option>
                            <option value="4">service4.jpg (助還代償)</option>
                            <option value="5">service5.jpg (黃金鑽石典當)</option>
                            <option value="6">service6.jpg (現金信用貸款)</option>
                        </select>
                        <input type="file" id="service-photo-upload" accept="image/jpeg,image/jpg,.jpg">
                    </div>
                </div>

                <!-- 更新關於我們 -->
                <div class="card">
                    <h2>更新關於我們</h2>
                    <div class="input-group">
                        <label>上傳內容（必須為 about.txt）</label>
                        <input type="file" id="about-upload" accept="text/plain,.txt">
                    </div>
                </div>

                <!-- 更新聯絡資訊 -->
                <div class="card">
                    <h2>更新聯絡資訊</h2>
                    <div class="input-group">
                        <label>Facebook 連結</label>
                        <input type="text" id="facebook-input" placeholder="輸入 Facebook 連結">
                    </div>
                    <div class="input-group">
                        <label>電話號碼</label>
                        <input type="text" id="phone-input" placeholder="輸入電話號碼 (例如 0911-222-333)">
                    </div>
                    <div class="input-group">
                        <label>Line 連結</label>
                        <input type="text" id="line-input" placeholder="輸入 Line 連結">
                    </div>
                    <div class="input-group">
                        <label>X 連結</label>
                        <input type="text" id="x-input" placeholder="輸入 X 連結">
                    </div>
                    <div class="input-group">
                        <label>Instagram 連結</label>
                        <input type="text" id="instagram-input" placeholder="輸入 Instagram 連結">
                    </div>
                    <button id="update-contact-btn" class="update-contact-btn">更新聯絡資訊</button>
                </div>

                <!-- 網站初始化內容 -->
                <div class="card">
                    <h2>網站初始化內容</h2>
                    <div class="download-section">
                        <p>若 .txt 檔案遺失或內容出現問題，請下載初始化檔案，解壓縮後重新上傳至對應欄位。</p>
                        <a href="https://stockcorp.github.io/pawnshop/content/ini.zip" download>下載初始化檔案 (ini.zip)</a>
                    </div>
                </div>
            </div>

            <!-- 上傳按鈕 -->
            <button id="upload-btn" class="upload-btn">上傳</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log('後台頁面載入完成，初始化事件');

            // 初始化元素
            const githubTokenInput = document.getElementById('github-token');
            const indexUpload = document.getElementById('index-upload');
            const newsUpload = document.getElementById('news-upload');
            const photoUpload = document.getElementById('photo-upload');
            const photoSelect = document.getElementById('photo-select');
            const photoCount = document.getElementById('photo-count');
            const serviceUpload = document.getElementById('service-upload');
            const servicePhotoUpload = document.getElementById('service-photo-upload');
            const servicePhotoSelect = document.getElementById('service-photo-select');
            const aboutUpload = document.getElementById('about-upload');
            const facebookInput = document.getElementById('facebook-input');
            const phoneInput = document.getElementById('phone-input');
            const lineInput = document.getElementById('line-input');
            const xInput = document.getElementById('x-input');
            const instagramInput = document.getElementById('instagram-input');
            const nameInput = document.getElementById('name-input');
            const websiteInput = document.getElementById('website-input');
            const updateContactBtn = document.getElementById('update-contact-btn');
            const updateNameBtn = document.getElementById('update-name-btn');
            const updateWebsiteBtn = document.getElementById('update-website-btn');
            const errorMessage = document.getElementById('error-message');
            const uploadBtn = document.getElementById('upload-btn');
            const headerTitle = document.getElementById('header-title');
            const consoleTitle = document.getElementById('console-title');

            // 檢查按鈕是否存在
            if (!uploadBtn || !updateContactBtn || !updateNameBtn || !updateWebsiteBtn) {
                console.error('未找到按鈕，檢查 ID');
                alert('頁面初始化失敗，請重新載入！');
                return;
            }

            // 載入網站名稱
            fetch('content/name.txt')
                .then(response => response.ok ? response.text() : Promise.reject('檔案未找到'))
                .then(data => {
                    const name = data.trim();
                    nameInput.value = name;
                    headerTitle.textContent = `${name}後台管理`;
                    consoleTitle.textContent = `${name} - 後台管理`;
                })
                .catch(error => {
                    console.error('載入網站名稱失敗:', error);
                    nameInput.value = 'XX當鋪';
                    headerTitle.textContent = 'XX當鋪後台管理';
                    consoleTitle.textContent = 'XX當鋪 - 後台管理';
                });

            // 載入網站地址
            fetch('content/website.txt')
                .then(response => response.ok ? response.text() : Promise.reject('檔案未找到'))
                .then(data => {
                    websiteInput.value = data.trim();
                })
                .catch(error => {
                    console.error('載入網站地址失敗:', error);
                    websiteInput.value = 'https://stockcorp.github.io/pawnshop';
                });

            // 動態更新照片下拉選單
            function updatePhotoSelect(count) {
                photoSelect.innerHTML = '';
                const maxCount = Math.min(count, 50);
                for (let i = 1; i <= maxCount; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = `pic${i}.jpg`;
                    photoSelect.appendChild(option);
                }
            }

            photoCount.addEventListener('input', () => {
                const count = parseInt(photoCount.value) || 1;
                updatePhotoSelect(count);
            });

            // 初始化照片下拉選單（預設 10）
            updatePhotoSelect(10);

            // 輸入驗證（防止 XSS）
            function sanitizeInput(input) {
                const div = document.createElement('div');
                div.textContent = input;
                return div.innerHTML;
            }

            function validateUrl(url) {
                if (!url) return true;
                const regex = /^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/;
                return regex.test(url);
            }

            function validatePhone(phone) {
                if (!phone) return true;
                const regex = /^(\+?\d{1,4}[-.\s]?)?\d{3}[-.\s]?\d{3}[-.\s]?\d{3,4}$/;
                return regex.test(phone);
            }

            // 更新網站名稱
            updateNameBtn.addEventListener('click', async () => {
                console.log('點擊更新網站名稱按鈕');
                try {
                    const token = githubTokenInput.value.trim();
                    errorMessage.style.display = 'none';
                    if (!token) {
                        console.log('未輸入 PAT');
                        errorMessage.textContent = '請輸入有效的 PAT！';
                        errorMessage.style.display = 'block';
                        alert('請輸入有效的 PAT！');
                        return;
                    }

                    const name = sanitizeInput(nameInput.value.trim());
                    if (!name) {
                        alert('請輸入網站名稱！');
                        return;
                    }

                    const base64Content = btoa(unescape(encodeURIComponent(name)));
                    const uploadSuccess = await uploadToGitHub(token, 'content/name.txt', base64Content, 'name.txt');
                    if (uploadSuccess) {
                        console.log('上傳 name.txt 成功');
                        headerTitle.textContent = `${name}後台管理`;
                        consoleTitle.textContent = `${name} - 後台管理`;
                        alert('網站名稱已成功更新！');
                    } else {
                        console.log('上傳 name.txt 失敗');
                        alert('網站名稱上傳失敗，請檢查 PAT 或網路！');
                    }
                } catch (error) {
                    console.error('上傳網站名稱錯誤: ' + error.message);
                    alert('上傳網站名稱時發生錯誤：' + error.message);
                }
            });

            // 更新網站地址
            updateWebsiteBtn.addEventListener('click', async () => {
                console.log('點擊更新網站地址按鈕');
                try {
                    const token = githubTokenInput.value.trim();
                    errorMessage.style.display = 'none';
                    if (!token) {
                        console.log('未輸入 PAT');
                        errorMessage.textContent = '請輸入有效的 PAT！';
                        errorMessage.style.display = 'block';
                        alert('請輸入有效的 PAT！');
                        return;
                    }

                    const website = sanitizeInput(websiteInput.value.trim());
                    if (!website || !validateUrl(website)) {
                        alert('請輸入有效的網站地址！');
                        return;
                    }

                    const base64Content = btoa(unescape(encodeURIComponent(website)));
                    const uploadSuccess = await uploadToGitHub(token, 'content/website.txt', base64Content, 'website.txt');
                    if (uploadSuccess) {
                        console.log('上傳 website.txt 成功');
                        alert('網站地址已成功更新！');
                    } else {
                        console.log('上傳 website.txt 失敗');
                        alert('網站地址上傳失敗，請檢查 PAT 或網路！');
                    }
                } catch (error) {
                    console.error('上傳網站地址錯誤: ' + error.message);
                    alert('上傳網站地址時發生錯誤：' + error.message);
                }
            });

            // 更新聯絡資訊
            updateContactBtn.addEventListener('click', async () => {
                console.log('點擊更新聯絡資訊按鈕');
                try {
                    const token = githubTokenInput.value.trim();
                    errorMessage.style.display = 'none';
                    if (!token) {
                        console.log('未輸入 PAT');
                        errorMessage.textContent = '請輸入有效的 PAT！';
                        errorMessage.style.display = 'block';
                        alert('請輸入有效的 PAT！');
                        return;
                    }

                    // 載入現有聯絡資訊
                    let currentContact = {
                        facebook: "",
                        phone: "",
                        line: "",
                        x: "",
                        instagram: ""
                    };
                    try {
                        const response = await fetch('content/contact.txt');
                        if (response.ok) {
                            currentContact = JSON.parse(await response.text());
                        }
                    } catch (e) {
                        console.warn('載入現有聯絡資訊失敗，使用預設值');
                    }

                    const facebook = sanitizeInput(facebookInput.value.trim());
                    const phone = sanitizeInput(phoneInput.value.trim());
                    const line = sanitizeInput(lineInput.value.trim());
                    const x = sanitizeInput(xInput.value.trim());
                    const instagram = sanitizeInput(instagramInput.value.trim());

                    if (facebook && !validateUrl(facebook)) {
                        alert('請輸入有效的 Facebook 連結！');
                        return;
                    }
                    if (phone && !validatePhone(phone)) {
                        alert('請輸入有效的電話號碼！');
                        return;
                    }
                    if (line && !validateUrl(line)) {
                        alert('請輸入有效的 Line 連結！');
                        return;
                    }
                    if (x && !validateUrl(x)) {
                        alert('請輸入有效的 X 連結！');
                        return;
                    }
                    if (instagram && !validateUrl(instagram)) {
                        alert('請輸入有效的 Instagram 連結！');
                        return;
                    }

                    const contactData = {
                        facebook: facebook,
                        phone: phone ? `tel:${phone.replace(/[-.\s]/g, '')}` : "",
                        line: line,
                        x: x,
                        instagram: instagram
                    };
                    const updatedFields = [];
                    if (facebook) updatedFields.push('Facebook 連結');
                    if (phone) updatedFields.push('電話號碼');
                    if (line) updatedFields.push('Line 連結');
                    if (x) updatedFields.push('X 連結');
                    if (instagram) updatedFields.push('Instagram 連結');

                    const contactJson = JSON.stringify(contactData, null, 2);
                    const base64Content = btoa(unescape(encodeURIComponent(contactJson)));
                    const uploadSuccess = await uploadToGitHub(token, 'content/contact.txt', base64Content, 'contact.txt');
                    if (uploadSuccess) {
                        console.log('上傳 contact.txt 成功');
                        alert(`${updatedFields.join('、') || '聯絡資訊'}已成功更新！`);
                    } else {
                        console.log('上傳 contact.txt 失敗');
                        alert('聯絡資訊上傳失敗，請檢查 PAT 或網路！');
                    }
                } catch (error) {
                    console.error('上傳聯絡資訊錯誤: ' + error.message);
                    alert('上傳聯絡資訊時發生錯誤：' + error.message);
                }
            });

            // 上傳檔案
            uploadBtn.addEventListener('click', async () => {
                console.log('點擊上傳按鈕，開始處理');
                try {
                    const token = githubTokenInput.value.trim();
                    errorMessage.style.display = 'none';
                    if (!token) {
                        console.log('未輸入 PAT');
                        errorMessage.textContent = '請輸入有效的 PAT！';
                        errorMessage.style.display = 'block';
                        alert('請輸入有效的 PAT！');
                        return;
                    }

                    let uploaded = false;

                    // 上傳首頁
                    if (indexUpload.files.length > 0) {
                        const file = indexUpload.files[0];
                        console.log('選擇首頁檔案: ' + file.name + ', 類型: ' + file.type);
                        if (file.name !== 'index.txt') {
                            console.log('首頁檔案名稱錯誤');
                            alert('首頁檔案名稱必須為 index.txt！');
                            return;
                        }
                        if (!['text/plain', 'application/octet-stream'].includes(file.type)) {
                            console.log('首頁檔案格式錯誤');
                            alert('請上傳 .txt 檔案！');
                            return;
                        }

                        try {
                            const content = await file.text();
                            const base64Content = btoa(unescape(encodeURIComponent(content)));
                            const uploadSuccess = await uploadToGitHub(token, 'content/index.txt', base64Content, file.name);
                            if (uploadSuccess) {
                                console.log('上傳 index.txt 成功');
                                alert('首頁內容已成功上傳！');
                                uploaded = true;
                            } else {
                                console.log('上傳 index.txt 失敗');
                                alert('首頁內容上傳失敗，請檢查 PAT 或網路！');
                            }
                        } catch (error) {
                            console.error('上傳 index.txt 錯誤: ' + error.message);
                            alert('上傳首頁內容時發生錯誤：' + error.message);
                        }
                    }

                    // 上傳最新消息（文字）
                    if (newsUpload.files.length > 0) {
                        const file = newsUpload.files[0];
                        console.log('選擇最新消息檔案: ' + file.name + ', 類型: ' + file.type);
                        if (file.name !== 'news.txt') {
                            console.log('最新消息檔案名稱錯誤');
                            alert('最新消息檔案名稱必須為 news.txt！');
                            return;
                        }
                        if (!['text/plain', 'application/octet-stream'].includes(file.type)) {
                            console.log('最新消息檔案格式錯誤');
                            alert('請上傳 .txt 檔案！');
                            return;
                        }

                        try {
                            const content = await file.text();
                            const base64Content = btoa(unescape(encodeURIComponent(content)));
                            const uploadSuccess = await uploadToGitHub(token, 'content/news.txt', base64Content, file.name);
                            if (uploadSuccess) {
                                console.log('上傳 news.txt 成功');
                                alert('最新消息文字已成功上傳！');
                                uploaded = true;
                            } else {
                                console.log('上傳 news.txt 失敗');
                                alert('最新消息文字上傳失敗，請檢查 PAT 或網路！');
                            }
                        } catch (error) {
                            console.error('上傳 news.txt 錯誤: ' + error.message);
                            alert('上傳最新消息文字時發生錯誤：' + error.message);
                        }
                    }

                    // 上傳最新消息（圖片）
                    if (photoUpload.files.length > 0) {
                        const file = photoUpload.files[0];
                        console.log('選擇最新消息照片檔案: ' + file.name + ', 類型: ' + file.type);
                        if (!['image/jpeg', 'image/jpg'].includes(file.type)) {
                            console.log('最新消息照片檔案格式錯誤');
                            alert('請上傳 .jpg 檔案！');
                            return;
                        }

                        try {
                            const reader = new FileReader();
                            const base64Content = await new Promise(resolve => {
                                reader.onload = () => resolve(reader.result.split(',')[1]);
                                reader.readAsDataURL(file);
                            });
                            const selectedPic = 'img/pic' + photoSelect.value + '.jpg';
                            const uploadSuccess = await uploadToGitHub(token, selectedPic, base64Content, file.name);
                            if (uploadSuccess) {
                                console.log('上傳 ' + selectedPic + ' 成功');
                                alert('最新消息圖片 ' + selectedPic + ' 已成功上傳！');
                                uploaded = true;
                            } else {
                                console.log('上傳 ' + selectedPic + ' 失敗');
                                alert('最新消息圖片 ' + selectedPic + ' 上傳失敗，請檢查 PAT 或網路！');
                            }
                        } catch (error) {
                            console.error('上傳 ' + selectedPic + ' 錯誤: ' + error.message);
                            alert('上傳最新消息圖片時發生錯誤：' + error.message);
                        }
                    }

                    // 上傳服務介紹（文字）
                    if (serviceUpload.files.length > 0) {
                        const file = serviceUpload.files[0];
                        console.log('選擇服務介紹檔案: ' + file.name + ', 類型: ' + file.type);
                        if (file.name !== 'service.txt') {
                            console.log('服務介紹檔案名稱錯誤');
                            alert('服務介紹檔案名稱必須為 service.txt！');
                            return;
                        }
                        if (!['text/plain', 'application/octet-stream'].includes(file.type)) {
                            console.log('服務介紹檔案格式錯誤');
                            alert('請上傳 .txt 檔案！');
                            return;
                        }

                        try {
                            const content = await file.text();
                            const base64Content = btoa(unescape(encodeURIComponent(content)));
                            const uploadSuccess = await uploadToGitHub(token, 'content/service.txt', base64Content, file.name);
                            if (uploadSuccess) {
                                console.log('上傳 service.txt 成功');
                                alert('服務介紹文字已成功上傳！');
                                uploaded = true;
                            } else {
                                console.log('上傳 service.txt 失敗');
                                alert('服務介紹文字上傳失敗，請檢查 PAT 或網路！');
                            }
                        } catch (error) {
                            console.error('上傳 service.txt 錯誤: ' + error.message);
                            alert('上傳服務介紹文字時發生錯誤：' + error.message);
                        }
                    }

                    // 上傳服務介紹（圖片）
                    if (servicePhotoUpload.files.length > 0) {
                        const file = servicePhotoUpload.files[0];
                        console.log('選擇服務照片檔案: ' + file.name + ', 類型: ' + file.type);
                        if (!['image/jpeg', 'image/jpg'].includes(file.type)) {
                            console.log('服務照片檔案格式錯誤');
                            alert('請上傳 .jpg 檔案！');
                            return;
                        }

                        try {
                            const reader = new FileReader();
                            const base64Content = await new Promise(resolve => {
                                reader.onload = () => resolve(reader.result.split(',')[1]);
                                reader.readAsDataURL(file);
                            });
                            const selectedPic = 'img/service' + servicePhotoSelect.value + '.jpg';
                            const uploadSuccess = await uploadToGitHub(token, selectedPic, base64Content, file.name);
                            if (uploadSuccess) {
                                console.log('上傳 ' + selectedPic + ' 成功');
                                alert('服務圖片 ' + selectedPic + ' 已成功上傳！');
                                uploaded = true;
                            } else {
                                console.log('上傳 ' + selectedPic + ' 失敗');
                                alert('服務圖片 ' + selectedPic + ' 上傳失敗，請檢查 PAT 或網路！');
                            }
                        } catch (error) {
                            console.error('上傳 ' + selectedPic + ' 錯誤: ' + error.message);
                            alert('上傳服務圖片時發生錯誤：' + error.message);
                        }
                    }

                    // 上傳關於我們
                    if (aboutUpload.files.length > 0) {
                        const file = aboutUpload.files[0];
                        console.log('選擇關於我們檔案: ' + file.name + ', 類型: ' + file.type);
                        if (file.name !== 'about.txt') {
                            console.log('關於我們檔案名稱錯誤');
                            alert('關於我們檔案名稱必須為 about.txt！');
                            return;
                        }
                        if (!['text/plain', 'application/octet-stream'].includes(file.type)) {
                            console.log('關於我們檔案格式錯誤');
                            alert('請上傳 .txt 檔案！');
                            return;
                        }

                        try {
                            const content = await file.text();
                            const base64Content = btoa(unescape(encodeURIComponent(content)));
                            const uploadSuccess = await uploadToGitHub(token, 'content/about.txt', base64Content, file.name);
                            if (uploadSuccess) {
                                console.log('上傳 about.txt 成功');
                                alert('關於我們內容已成功上傳！');
                                uploaded = true;
                            } else {
                                console.log('上傳 about.txt 失敗');
                                alert('關於我們內容上傳失敗，請檢查 PAT 或網路！');
                            }
                        } catch (error) {
                            console.error('上傳 about.txt 錯誤: ' + error.message);
                            alert('上傳關於我們內容時發生錯誤：' + error.message);
                        }
                    }

                    if (!uploaded) {
                        console.log('無檔案選擇，提示用戶');
                        alert('請選擇要上傳的檔案！');
                    }
                } catch (error) {
                    console.error('上傳過程發生錯誤: ' + error.message);
                    alert('上傳失敗，請檢查網路或 PAT！');
                }
            });

            // GitHub API 上傳函數
            async function uploadToGitHub(token, path, base64Content, fileName) {
                console.log('開始上傳至 GitHub: ' + path);
                try {
                    const repo = 'stockcorp/pawnshop';
                    let sha = null;
                    try {
                        const getResponse = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`, {
                            headers: {
                                'Authorization': `token ${token}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        });
                        if (getResponse.ok) {
                            const getData = await getResponse.json();
                            sha = getData.sha;
                            console.log('獲取檔案 SHA: ' + sha);
                        } else if (getResponse.status === 404) {
                            console.log('檔案不存在，將創建新檔案');
                        } else {
                            console.error('獲取檔案資訊失敗，狀態碼: ' + getResponse.status);
                            return false;
                        }
                    } catch (error) {
                        console.warn('獲取 SHA 失敗，可能為新檔案: ' + error.message);
                    }

                    const response = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: `上傳 ${fileName}`,
                            content: base64Content,
                            sha: sha
                        })
                    });

                    if (response.ok) {
                        console.log('GitHub API 上傳成功: ' + path);
                        return true;
                    } else {
                        const errorData = await response.json();
                        console.error('GitHub API 上傳失敗: ' + errorData.message);
                        if (errorData.message.includes('Not Found')) {
                            alert('上傳失敗: 倉庫 stockcorp/pawnshop 不存在或檔案路徑無效！');
                        } else if (errorData.message.includes('Invalid token')) {
                            alert('上傳失敗: 無效的 PAT，請確認權限！');
                        } else {
                            alert('上傳失敗: